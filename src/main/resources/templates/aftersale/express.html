<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
	<title>订单物流查询</title>
	<script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://rugucdn.oss-cn-qingdao.aliyuncs.com/libs/refund.css">
	<script src="https://rugucdn.oss-cn-qingdao.aliyuncs.com/libs/layer/layer.js"></script>
</head>

<body>
<div class="audit-1">
	<div style="padding:10px">
		<h2>查询说明：</h2>
		<p>·输入下单手机号码即可查询物流信息。</p>
		<p>·今日订单物流需要24小时以后才可以查询到。</p>
	</div>


	<div class="main-bg">
		<div class="main">
			<div class="query">

				<div class="query-l fl" style="margin-top:15px;">
					<input id="mobile" name="mobile" type="tel" maxlength="11" placeholder="请填写下单手机号" th:value="${mobile}"/>
				</div>

				<div class="query-r fr" style="margin-top:15px;"><span id="sorder" style="background:#cf2a4f">查询</span></div>
			</div>
		</div>
	</div>
</div>

<div class="list-bg"  id="pdiv">
	<!-- 订单物流信息 -->
	<!--<div class="main-bg" th:if="${isValue=='1'}" th:each="order,index : ${orderList}">
		<div class="main">
			<dl class="dl"><dt>订单编号：</dt><dd th:text="${order.orderCode}">2019110911301234</dd></dl>
			<dl class="dl"><dt>订购产品：</dt><dd th:text="${order.goodsName}">商品</dd></dl>
			<dl class="dl"><dt>订购数量：</dt><dd th:text="${order.goodsNumber}">1</dd></dl>
			<dl class="dl"><dt>订单金额：</dt><dd th:text="${order.orderPrice}">186.9</dd></dl>
			<dl class="dl">
				<dt>订单状态：</dt>
				&lt;!&ndash;订单状态1&ndash;&gt;
				<dd th:if="${order.orderStatus == '1'}"><span style="height:18px;line-height:18px;border-radius:.25em;background-color:#5cb85c;">已支付</span></dd>
				&lt;!&ndash;订单状态2&ndash;&gt;
				<dd th:if="${order.orderStatus == '0'}"><span style="height:18px;line-height:18px;border-radius:.25em;background-color:#777;">未支付</span></dd>
			</dl>
			<dl class="dl"><dt>订单姓名：</dt><dd th:text="${order.shippingPerson}">故此</dd></dl>
			<dl class="dl"><dt>订单手机：</dt><dd th:text="${order.mobile}">13542330241</dd></dl>
			<dl class="dl">
				<dt>订单地址：</dt>
				<dd th:text="${order.shippingProvince}+' '+${order.shippingCity}+' '+${order.shippingCounty}+' '+${order.shippingAddress}"></dd>
			</dl>
			&lt;!&ndash; 快递1 &ndash;&gt;
			<div th:if="${order.orderStatus == '2'}">
				<dl class="dl" th:if="${order.expressName != null}"><dt>快递公司：</dt><dd th:text="${order.expressName}">顺丰快递</dl></dd>
				<dl class="dl">
					<dt>快递单号：</dt>
					<a href="http://page.cainiao.com/guoguo/app-myexpress-taobao/express-detail.html?mailNo='+orders[i].eid+'">
						<dd th:text="${order.expressCode}">2019110911301</a><div style="display:inline-block;"><button class="copyBtn" style="border: 0;background-color: transparent;outline: none;" data-clipboard-target="#copyVal"><svg t="1564384640835" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5782" width="20" height="20"><path d="M740.6 183.3v71.5h-57.2v-71.5c0-3.8-1.4-7.3-4.2-10-2.8-2.8-6.2-4.2-10-4.2H183.4c-3.8 0-7.3 1.4-10 4.2-2.7 2.8-4.2 6.2-4.2 10v485.9c0 3.8 1.4 7.3 4.2 10 2.8 2.8 6.2 4.2 10 4.2h71.5v57.2h-71.5c-19.6 0-36.5-7-50.4-20.9-14-14-21-30.9-21-50.5V183.3c0-19.6 7-36.5 20.9-50.4 13.9-13.9 30.8-20.9 50.4-20.9h485.9c19.6 0 36.5 7.1 50.4 20.9 14 14 21 30.8 21 50.4z m171.5 171.5v485.9c0 19.6-7.1 36.5-20.9 50.4-14 14-30.8 20.9-50.4 20.9H354.9c-19.6 0-36.5-7.1-50.4-20.9-14-14-20.9-30.8-20.9-50.4V354.8c0-19.6 7-36.5 20.9-50.4 13.9-13.9 30.8-20.9 50.4-20.9h485.9c19.6 0 36.5 7.1 50.4 20.9 13.9 14 20.9 30.8 20.9 50.4z" p-id="5783" fill="#d81e06"></path></svg></button></div></dd>
				</dl>
			</div>
			&lt;!&ndash; 快递2 &ndash;&gt;
			<div th:if="${order.orderStatus == '1'}">
				<dl class="dl"><dt>快递公司：</dt><dd>您的宝贝正在打包中，快递数据24小时内更新。</dd></dl>
				<dl class="dl"><dt>快递单号：</dt><dd>暂无</dd></dl>
			</div>
			<dl class="dl"><dt>下单时间：</dt><dd th:text="${order.createTimeF}">2019-11-09 11:30</dd></dl>
		</div>
	</div>-->
</div>
<div style="height:150px;"></div>
<div style="opacity: 0;"><input type="text" id="copyVal" readonly value="'+orders[i].eid+'" /></div>
<script>
	var mobile=$('#mobile').val();
	if(mobile!=''){
		gosearch(mobile);
	}

	$('#sorder').click(function(){
		mobile = $('#mobile').val();
		if(mobile==''){
			layer.open({content: '下单手机号不能为空',skin: 'msg',time: 3 });
			return false;
		}

		if(!checkMobile(mobile)){
			layer.open({content: '手机号码格式有误，请重填',skin: 'msg',time: 3 });
			return false;
		}
		gosearch(mobile);
	});

	//验证必须是正确的手机号
	function checkMobile(val){
		var reg =/^1[3456789]\d{9}$/;
		if(reg.test(val)){
			return true;
		}else{
			return false;
		}
	}

	function gosearch(mobile){
		var jz = layer.open({
			type: 2
			,content: '查询中',
			shadeClose: false
		});

		$.ajax({
			type : "POST",
			url : "/aftersales/express-info",
			data : {mobile:mobile},
			dataType : "json",
			success : function(result) {
				if (result.status=="0"){
					layer.close(jz);
					$("#pdiv").html('');
					var orders = result.data;
					var res_html = '';
					for(var i=0;i<orders.length;i++){
						res_html = '<div class="main-bg"><div class="main">';
						res_html += '<dl class="dl"><dt>订单编号：</dt><dd>'+orders[i].orderCode+'</dd></dl>';
						res_html += '<dl class="dl"><dt>订购产品：</dt><dd>'+orders[i].goodsName+'</dd></dl>';
						var pap = orders[i].pattern;
						if(orders[i].sex !=null){pap += "-"+orders[i].sex;}
						if(orders[i].attr !=null){pap += "-"+orders[i].attr;}
						res_html += '<dl class="dl"><dt>订购数量：</dt><dd>'+orders[i].goodsNumber+'</dd></dl>';
						res_html += '<dl class="dl"><dt>订单金额：</dt><dd>'+orders[i].orderPrice+'</dd></dl>';
						if(orders[i].orderStatus == "1" || orders[i].orderStatus == "2" || orders[i].orderStatus == "3"){
							var statusValue = "";
							if(orders[i].orderStatus == "1"){
								statusValue = "待发货";
							}else if(orders[i].orderStatus == "2"){
								statusValue = "待收货";
							}else if(orders[i].orderStatus == "3"){
								statusValue = "交易完成";
							}
							res_html += '<dl class="dl"><dt>订单状态：</dt><dd><span style="height:18px;line-height:18px;border-radius:.25em;background-color:#5cb85c;">'+statusValue+'</span></dd></dl>';
						}else if(orders[i].orderStatus == "0"){
							res_html += '<dl class="dl"><dt>订单状态：</dt><dd><span style="height:18px;line-height:18px;border-radius:.25em;background-color:#777;">未支付</span></dd></dl>';
						}
						res_html += '<dl class="dl"><dt>订单姓名：</dt><dd>'+orders[i].shippingPerson+'</dd></dl>';
						res_html += '<dl class="dl"><dt>订单手机：</dt><dd>'+orders[i].mobile+'</dd></dl>';
						res_html += '<dl class="dl"><dt>订单地址：</dt><dd>'+orders[i].shippingProvince+' '+orders[i].shippingCity+' '+orders[i].shippingCounty+' '+orders[i].shippingAddress+'</dd></dl>';
						if(orders[i].expressCode != null){
							if(orders[i].expressName != null){
								res_html += '<dl class="dl"><dt>快递公司：</dt><dd>'+orders[i].expressName+'</dl></dd>';
							}
							$("#copyVal").val(orders[i].expressCode);
							res_html += '<dl class="dl"><dt>快递单号：</dt><a href="http://page.cainiao.com/guoguo/app-myexpress-taobao/express-detail.html?mailNo='+orders[i].expressCode+'"><dd>'+orders[i].expressCode+'</a><div style="display:inline-block;"><button class="copyBtn" style="border: 0;background-color: transparent;outline: none;" data-clipboard-target="#copyVal"><svg t="1564384640835" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5782" width="20" height="20"><path d="M740.6 183.3v71.5h-57.2v-71.5c0-3.8-1.4-7.3-4.2-10-2.8-2.8-6.2-4.2-10-4.2H183.4c-3.8 0-7.3 1.4-10 4.2-2.7 2.8-4.2 6.2-4.2 10v485.9c0 3.8 1.4 7.3 4.2 10 2.8 2.8 6.2 4.2 10 4.2h71.5v57.2h-71.5c-19.6 0-36.5-7-50.4-20.9-14-14-21-30.9-21-50.5V183.3c0-19.6 7-36.5 20.9-50.4 13.9-13.9 30.8-20.9 50.4-20.9h485.9c19.6 0 36.5 7.1 50.4 20.9 14 14 21 30.8 21 50.4z m171.5 171.5v485.9c0 19.6-7.1 36.5-20.9 50.4-14 14-30.8 20.9-50.4 20.9H354.9c-19.6 0-36.5-7.1-50.4-20.9-14-14-20.9-30.8-20.9-50.4V354.8c0-19.6 7-36.5 20.9-50.4 13.9-13.9 30.8-20.9 50.4-20.9h485.9c19.6 0 36.5 7.1 50.4 20.9 13.9 14 20.9 30.8 20.9 50.4z" p-id="5783" fill="#d81e06"></path></svg></button></div></dd></dl>';
						}else{
							if(orders[i].orderStatus == "1"){
								res_html += '<dl class="dl"><dt>快递单号：</dt><dd>您的宝贝正在打包中，快递数据24小时内更新。</dd></dl>';
							}else if(orders[i].orderStatus == "0"){
								res_html += '<dl class="dl"><dt>快递单号：</dt><dd>暂无</dd></dl>';
							}
						}

						res_html += '<dl class="dl"><dt>下单时间：</dt><dd>'+orders[i].createTimeF+'</dd></dl>';
						if(orders[i].orderStatus == "0") {
							res_html += '<dl class="dl"><dt></dt><dd><a href=/pay/doPay/' + orders[i].id + '><span style="height:18px;line-height:18px;border-radius:.25em;background-color:#5cb85c;">去&nbsp;支&nbsp;付</span></a></dd></dl>';
						}
						res_html += '</div></div>';
						$("#pdiv").append(res_html);
					}
					$("#pdiv").show();

				}else{
					layer.close(jz);
					$("#pdiv").hide();
					layer.open({content: result.msg,skin: 'msg',time: 3 });
				}
			},error:function(){
				layer.close(jz);
				layer.open({content: '您的网络不稳定，请关闭页面后重试',skin: 'msg',time: 3 });
			}
		});
	}

</script>

<script src="https://rugucdn.oss-cn-qingdao.aliyuncs.com/libs/new_showpage/clipboard.min.js"></script>
<script>
	var copyBtn = new ClipboardJS('.copyBtn');
	copyBtn.on("success",function(e){
		// 复制成功
		layer.open({content: '快递单号复制成功',skin: 'msg',time: 3 });
		e.clearSelection();
	});
	copyBtn.on("error",function(e){
		//复制失败；
		console.log( e.action )
		alert(e.action);
	});
</script>

</body>
</html>